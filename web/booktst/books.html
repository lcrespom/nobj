<table id="books">
	<thead>
		<tr>
			<th>Title</th>
			<th>Author</th>
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>

<script>
	require(['data'], function(data) {

		function registerActions(row, book) {
			$("a.editLink", row).click(function() { window.books.current = book });
			$("a.delLink", row).click(function() {
				data.delete('books', book._id).done(function(result) {
					alert("Book deleted: " + result);
					row.remove();
				}).fail(function(err) {
					alert("Error: " + err);
				});
				return false;
			});
		}

		data.get('books').done(function(result) {
			var items = result.items;
			var rows = $("#books tbody");
			for (var i = 0; i < items.length; i++) {
				var book = items[i];
				var newRow = '<tr><td>' + book.title + '</td>';
				newRow += '<td>' + book.author + '</td>';
				newRow += '<td><a class="editLink" href="#edit">Edit</a>';
				newRow += ' / <a class="delLink" href="">Delete</a></td></tr>';
				var newRowElement = $(newRow);
				registerActions(newRowElement, book);
				rows.append(newRowElement);
			}
		}).fail(function(err) {
			alert("Error: " + err);
		});

	});
</script>
